<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>San Diego Mexican Food Finder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    #filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin: 1rem 0;
      justify-content: center;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }
    .place {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .place img {
      max-width: 100%;
      border-radius: 4px;
      margin-top: 0.5rem;
    }
    .jerberto-rating {
      color: darkgreen;
      font-weight: bold;
    }
    #controls {
      text-align: center;
      margin-top: 1.5rem;
    }
    #map {
      height: 600px;
      display: none;
      margin-top: 1rem;
    }
    #video-modal {
      position: fixed;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 70%;
      background: white;
      display: none;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 10px black;
    }
    #video-frame {
      width: 100%;
      height: 100%;
      border: none;
    }
    #loading {
      text-align: center;
      font-size: 2rem;
      display: none;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      margin: 0 0.5rem;
    }
	.place {
	  background: #fff;
	  padding: 1rem;
	  border-radius: 8px;
	  box-shadow: 0 0 5px rgba(0,0,0,0.1);
	  cursor: pointer;
	  transition: background 0.3s ease;
	  position: relative;
	  z-index: 1;
	  overflow: hidden;
	}
	
	.place:hover {
	  background-image:
	    linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.3)),
	    url('https://upload.wikimedia.org/wikipedia/commons/f/fc/Flag_of_Mexico.svg');
	  background-size: cover;
	  background-position: center;
	  background-repeat: no-repeat;
	}
  </style>
</head>
<body>
  <h1>üåÆ San Diego Mexican Food Finder</h1>

  <div id="filters">
    <input type="text" id="filter-name" placeholder="Search by name" />
    <select id="filter-rating">
      <option value="">All Ratings</option>
      <option value="4">4+</option>
      <option value="4.5">4.5+</option>
    </select>
    <select id="filter-city">
      <option value="">All Cities</option>
    </select>
    <button onclick="toggleView()">üó∫Ô∏è Toggle Map View</button>
  </div>

  <div id="loading">üåØ Loading...</div>
  <div id="results"></div>
  <div id="map"></div>
  <div id="controls"></div>

  <div id="video-modal">
    <button onclick="closeVideo()">Close ‚úñÔ∏è</button>
    <iframe id="video-frame" allowfullscreen></iframe>
  </div>

  <script>
    let currentPage = 1;
    const perPage = 20;
    let totalPages = 1;
    let currentResults = [];

    function fetchPage() {
      document.getElementById('results').innerHTML = '';
      document.getElementById('loading').style.display = 'block';

      const endpoint = `/api/google-places-all?page=${currentPage}&limit=${perPage}`;

      fetch(endpoint)
        .then(res => res.json())
        .then(data => {
          currentResults = data.results || [];
          totalPages = data.totalPages || 1;
          renderResults();
        })
        .catch(err => {
          document.getElementById('results').innerHTML = `<p>Error: ${err.message}</p>`;
          document.getElementById('loading').style.display = 'none';
        });
    }

    function renderResults() {
      const html = currentResults.map(place => {
        const photoUrl = place.photoUrl;
        const jerbertoRating = "‚≠ê " + (Math.random() * 2 + 3).toFixed(1); // placeholder
        return `
          <div class="place" onclick="openVideo('${place.place_id}')">
            ${photoUrl ? `<img src="${photoUrl}" alt="Photo of ${place.name}" />` : ''}
            <div class="jerberto-rating">Jerberto's Rating: ${jerbertoRating}</div>
            <strong>${place.name}</strong><br/>
            ${place.vicinity || ''}<br/>
            Google: ‚≠ê ${place.rating || 'N/A'}
          </div>
        `;
      }).join('');

      document.getElementById('results').innerHTML = html;
      document.getElementById('loading').style.display = 'none';
      renderControls();
    }

    function renderControls() {
      document.getElementById('controls').innerHTML = `
        <button onclick="prevPage()" ${currentPage === 1 ? 'disabled' : ''}>‚¨ÖÔ∏è Prev</button>
        Page ${currentPage} of ${totalPages}
        <button onclick="nextPage()" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚û°Ô∏è</button>
      `;
    }

    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        fetchPage();
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        fetchPage();
      }
    }

    function toggleView() {
      const results = document.getElementById('results');
      const mapDiv = document.getElementById('map');
      const isMap = mapDiv.style.display === 'block';
      results.style.display = isMap ? 'grid' : 'none';
      mapDiv.style.display = isMap ? 'none' : 'block';
    }

    function openVideo(placeId) {
      const dummyVideo = "https://www.youtube.com/embed/dQw4w9WgXcQ";
      document.getElementById('video-frame').src = dummyVideo;
      document.getElementById('video-modal').style.display = 'block';
    }

    function closeVideo() {
      document.getElementById('video-frame').src = '';
      document.getElementById('video-modal').style.display = 'none';
    }

    window.onload = fetchPage;
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_BROWSER_API_KEY&callback=renderResults"></script>
</body>
</html>
